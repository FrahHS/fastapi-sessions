
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Ready-to-use session authentication for FastAPI">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.2.2">
    
    
      
        <title>Getting Started - FastAPI Sessions</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.1118c9be.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ba0d045b.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#getting-started" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="FastAPI Sessions" class="md-header__button md-logo" aria-label="FastAPI Sessions" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            FastAPI Sessions
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Getting Started
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/jordanisaacs/fastapi-sessions" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    jordanisaacs/fastapi-sessions
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="FastAPI Sessions" class="md-nav__button md-logo" aria-label="FastAPI Sessions" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    FastAPI Sessions
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/jordanisaacs/fastapi-sessions" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    jordanisaacs/fastapi-sessions
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        About
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../sessions/" class="md-nav__link">
        Sessions
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      <label class="md-nav__link" for="__nav_3">
        Guide
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Guide" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Getting Started
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Getting Started
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#install-fastapi-sessions" class="md-nav__link">
    Install FastAPI Sessions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#basic-usage" class="md-nav__link">
    Basic Usage
  </a>
  
    <nav class="md-nav" aria-label="Basic Usage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#session-data" class="md-nav__link">
    Session Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#session-frontend" class="md-nav__link">
    Session Frontend
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#session-backend" class="md-nav__link">
    Session Backend
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#session-verifier" class="md-nav__link">
    Session Verifier
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bringing-it-together" class="md-nav__link">
    Bringing it together
  </a>
  
    <nav class="md-nav" aria-label="Bringing it together">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-session-route" class="md-nav__link">
    Create Session Route
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#putting-it-all-together" class="md-nav__link">
    Putting it all together
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#install-fastapi-sessions" class="md-nav__link">
    Install FastAPI Sessions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#basic-usage" class="md-nav__link">
    Basic Usage
  </a>
  
    <nav class="md-nav" aria-label="Basic Usage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#session-data" class="md-nav__link">
    Session Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#session-frontend" class="md-nav__link">
    Session Frontend
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#session-backend" class="md-nav__link">
    Session Backend
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#session-verifier" class="md-nav__link">
    Session Verifier
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bringing-it-together" class="md-nav__link">
    Bringing it together
  </a>
  
    <nav class="md-nav" aria-label="Bringing it together">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-session-route" class="md-nav__link">
    Create Session Route
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#putting-it-all-together" class="md-nav__link">
    Putting it all together
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="getting-started">Getting started<a class="headerlink" href="#getting-started" title="Permanent link">&para;</a></h1>
<h2 id="install-fastapi-sessions">Install FastAPI Sessions<a class="headerlink" href="#install-fastapi-sessions" title="Permanent link">&para;</a></h2>
<p>The first step is to make sure you have FastAPI installed, along with Uvicorn for testing your API. If this sounds unfamiliar to you, first check out the <a href="https://fastapi.tiangolo.com/tutorial/">FastAPI tutorial</a></p>
<p>Assuming you have your environment ready, lets install the library using pip.</p>
<div class="highlight"><pre><span></span><code><span class="n">pip</span> <span class="n">install</span> <span class="n">fastapi</span><span class="o">-</span><span class="n">sessions</span>
</code></pre></div>
<h2 id="basic-usage">Basic Usage<a class="headerlink" href="#basic-usage" title="Permanent link">&para;</a></h2>
<p>To get up and running with FastAPI sessions there are three main components you will use.</p>
<ol>
<li><code>SessionFrontend</code> Abstract Class - This class provides the interface for extracting the session IDs from the request whether it is a cookie, header, etc.</li>
<li><code>SessionBackend</code> Abstract Class - This class provides the interface for CRUD operations of your session data.</li>
<li><code>SessionVerifier</code> Abstract Class - This class is where you verify that the provided session ID is actually valid.</li>
</ol>
<p>Now lets take a quick look at a quick API. More details on configurations and design choices will be covered later.</p>
<hr />
<h3 id="session-data">Session Data<a class="headerlink" href="#session-data" title="Permanent link">&para;</a></h3>
<p>Its as simple as creating a pydantic model. No catches!</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span>

<span class="k">class</span> <span class="nc">SessionData</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">username</span><span class="p">:</span> <span class="nb">str</span>
</code></pre></div>
<h3 id="session-frontend">Session Frontend<a class="headerlink" href="#session-frontend" title="Permanent link">&para;</a></h3>
<p>We will use the provided <code>SessionCookie</code> frontend. The cookie's value is the signed UUID that is used as a key to the session data on the backend. Take notice of the <code>identifier</code> parameter, it connects the frontend to its corresponding verifier.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">fastapi_sessions.frontends.implementations</span> <span class="kn">import</span> <span class="n">SessionCookie</span><span class="p">,</span> <span class="n">CookieParameters</span>

<span class="n">cookie_params</span> <span class="o">=</span> <span class="n">CookieParameters</span><span class="p">()</span>

<span class="c1"># Uses UUID</span>
<span class="n">cookie</span> <span class="o">=</span> <span class="n">SessionCookie</span><span class="p">(</span>
    <span class="n">cookie_name</span><span class="o">=</span><span class="s2">&quot;cookie&quot;</span><span class="p">,</span>
    <span class="n">identifier</span><span class="o">=</span><span class="s2">&quot;general_verifier&quot;</span><span class="p">,</span>
    <span class="n">auto_error</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">secret_key</span><span class="o">=</span><span class="s2">&quot;DONOTUSE&quot;</span><span class="p">,</span>
    <span class="n">cookie_params</span><span class="o">=</span><span class="n">cookie_params</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
<hr />
<h3 id="session-backend">Session Backend<a class="headerlink" href="#session-backend" title="Permanent link">&para;</a></h3>
<p>We will use the simple <code>InMemoryBackend[ID, Data]()</code> right now. It stores session data in the server's memory. As <code>SessionCookie</code> utilizes <code>UUID</code> that is our ID type.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">uuid</span> <span class="kn">import</span> <span class="n">UUID</span>
<span class="kn">from</span> <span class="nn">fastapi_sessions.backends.implementations</span> <span class="kn">import</span> <span class="n">InMemoryBackend</span>

<span class="n">backend</span> <span class="o">=</span> <span class="n">InMemoryBackend</span><span class="p">[</span><span class="n">UUID</span><span class="p">,</span> <span class="n">SessionData</span><span class="p">]()</span>
</code></pre></div>
<hr />
<h3 id="session-verifier">Session Verifier<a class="headerlink" href="#session-verifier" title="Permanent link">&para;</a></h3>
<p>With the data, frontend, and backend all set up we now need to write our verifier. We will keep it simple and just have it verify that the session exists in the backend. It is a little unseemly as it utilizes Python's abstract classes. Notice we inerit from <code>SessionVerifier</code> which does all the heavy lifting of reading from the backend and obtaining the session from the frontend. The <code>identifier</code> must match the corresponding frontend <code>identifier</code>.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">fastapi_sessions.session_verifier</span> <span class="kn">import</span> <span class="n">SessionVerifier</span>
<span class="kn">from</span> <span class="nn">fastapi</span> <span class="kn">import</span> <span class="n">HTTPException</span>

<span class="k">class</span> <span class="nc">BasicVerifier</span><span class="p">(</span><span class="n">SessionVerifier</span><span class="p">[</span><span class="n">UUID</span><span class="p">,</span> <span class="n">SessionData</span><span class="p">]):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">identifier</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">auto_error</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">backend</span><span class="p">:</span> <span class="n">InMemoryBackend</span><span class="p">[</span><span class="n">UUID</span><span class="p">,</span> <span class="n">SessionData</span><span class="p">],</span>
        <span class="n">auth_http_exception</span><span class="p">:</span> <span class="n">HTTPException</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_identifier</span> <span class="o">=</span> <span class="n">identifier</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_auto_error</span> <span class="o">=</span> <span class="n">auto_error</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_backend</span> <span class="o">=</span> <span class="n">backend</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_auth_http_exception</span> <span class="o">=</span> <span class="n">auth_http_exception</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">identifier</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_identifier</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">backend</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backend</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">auto_error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auto_error</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">auth_http_exception</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth_http_exception</span>

    <span class="k">def</span> <span class="nf">verify_session</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">SessionData</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;If the session exists, it is valid&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span>


<span class="n">verifier</span> <span class="o">=</span> <span class="n">BasicVerifier</span><span class="p">(</span>
    <span class="n">identifier</span><span class="o">=</span><span class="s2">&quot;general_verifier&quot;</span><span class="p">,</span>
    <span class="n">auto_error</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">,</span>
    <span class="n">auth_http_exception</span><span class="o">=</span><span class="n">HTTPException</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="mi">403</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;invalid session&quot;</span><span class="p">),</span>
<span class="p">)</span>
</code></pre></div>
<hr />
<h3 id="bringing-it-together">Bringing it together<a class="headerlink" href="#bringing-it-together" title="Permanent link">&para;</a></h3>
<p>Now we utilize FastAPI's <a href="https://fastapi.tiangolo.com/tutorial/dependencies/">dependency injection</a> system to protect your routes! Furthermore FastAPI Sessions is compatible with the OpenAPI specs so they will show up in your docs as authenticated routes.</p>
<h4 id="create-session-route">Create Session Route<a class="headerlink" href="#create-session-route" title="Permanent link">&para;</a></h4>
<p>Lets start with a simple session creation endpoint. This is not a protected.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">uuid</span> <span class="kn">import</span> <span class="n">uuid4</span>
<span class="kn">from</span> <span class="nn">fastapi</span> <span class="kn">import</span> <span class="n">FastAPI</span><span class="p">,</span> <span class="n">Response</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">()</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/create_session/</span><span class="si">{name}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">create_session</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">response</span><span class="p">:</span> <span class="n">Response</span><span class="p">):</span>

    <span class="n">session</span> <span class="o">=</span> <span class="n">uuid4</span><span class="p">()</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">SessionData</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

    <span class="k">await</span> <span class="n">backend</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
    <span class="n">cookie</span><span class="o">.</span><span class="n">attach_to_response</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">session</span><span class="p">)</span>

    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;created session for </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div>
<p>Now that our user can create a session, lets verify who they are. Notice how we depend on both the cookie and the verifier. The frontend must always be before the verifier as FastAPI Sessions relies on some <a href="https://github.com/tiangolo/fastapi/issues/2575">hackery</a>. It is to enable frontends and backends to be mixed and matched while still taking advantage of dependency injection and autodocs. The cookie extracts the session id and then the verifier checks the validity of the session.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">fastapi</span> <span class="kn">import</span> <span class="n">Depends</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/whoami&quot;</span><span class="p">,</span> <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="n">Depends</span><span class="p">(</span><span class="n">cookie</span><span class="p">)])</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">whoami</span><span class="p">(</span><span class="n">session_data</span><span class="p">:</span> <span class="n">SessionData</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">verifier</span><span class="p">)):</span>
    <span class="k">return</span> <span class="n">session_data</span>
</code></pre></div>
<p>To end a session (e.g. logout), just delete it from the backend. As we now require the <code>session_id</code> we move it to be a dependency that returns a value. Not all frontends have the option, but with cookies we can delete it in the response which we do.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/delete_session&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">del_session</span><span class="p">(</span><span class="n">response</span><span class="p">:</span> <span class="n">Response</span><span class="p">,</span> <span class="n">session_id</span><span class="p">:</span> <span class="n">UUID</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">cookie</span><span class="p">)):</span>
    <span class="k">await</span> <span class="n">backend</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">session_id</span><span class="p">)</span>
    <span class="n">cookie</span><span class="o">.</span><span class="n">delete_from_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
    <span class="k">return</span> <span class="s2">&quot;deleted session&quot;</span>
</code></pre></div>
<h2 id="putting-it-all-together">Putting it all together<a class="headerlink" href="#putting-it-all-together" title="Permanent link">&para;</a></h2>
<p>Now lets put it all back together to see our session based authentication app.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>While FastAPI-Sessions makes creating session based authentication easy, there are security implications.
Please read through all the docs, especially <a href="../../sessions">Sessions</a> (forthcoming), and do your own research if you have not worked with cookies and sessions for authentication before. </p>
</div>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span>
<span class="kn">from</span> <span class="nn">fastapi</span> <span class="kn">import</span> <span class="n">HTTPException</span><span class="p">,</span> <span class="n">FastAPI</span><span class="p">,</span> <span class="n">Response</span><span class="p">,</span> <span class="n">Depends</span>
<span class="kn">from</span> <span class="nn">uuid</span> <span class="kn">import</span> <span class="n">UUID</span><span class="p">,</span> <span class="n">uuid4</span>

<span class="kn">from</span> <span class="nn">fastapi_sessions.backends.implementations</span> <span class="kn">import</span> <span class="n">InMemoryBackend</span>
<span class="kn">from</span> <span class="nn">fastapi_sessions.session_verifier</span> <span class="kn">import</span> <span class="n">SessionVerifier</span>
<span class="kn">from</span> <span class="nn">fastapi_sessions.frontends.implementations</span> <span class="kn">import</span> <span class="n">SessionCookie</span><span class="p">,</span> <span class="n">CookieParameters</span>


<span class="k">class</span> <span class="nc">SessionData</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">username</span><span class="p">:</span> <span class="nb">str</span>


<span class="n">cookie_params</span> <span class="o">=</span> <span class="n">CookieParameters</span><span class="p">()</span>

<span class="c1"># Uses UUID</span>
<span class="n">cookie</span> <span class="o">=</span> <span class="n">SessionCookie</span><span class="p">(</span>
    <span class="n">cookie_name</span><span class="o">=</span><span class="s2">&quot;cookie&quot;</span><span class="p">,</span>
    <span class="n">identifier</span><span class="o">=</span><span class="s2">&quot;general_verifier&quot;</span><span class="p">,</span>
    <span class="n">auto_error</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">secret_key</span><span class="o">=</span><span class="s2">&quot;DONOTUSE&quot;</span><span class="p">,</span>
    <span class="n">cookie_params</span><span class="o">=</span><span class="n">cookie_params</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">backend</span> <span class="o">=</span> <span class="n">InMemoryBackend</span><span class="p">[</span><span class="n">UUID</span><span class="p">,</span> <span class="n">SessionData</span><span class="p">]()</span>


<span class="k">class</span> <span class="nc">BasicVerifier</span><span class="p">(</span><span class="n">SessionVerifier</span><span class="p">[</span><span class="n">UUID</span><span class="p">,</span> <span class="n">SessionData</span><span class="p">]):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">identifier</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">auto_error</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">backend</span><span class="p">:</span> <span class="n">InMemoryBackend</span><span class="p">[</span><span class="n">UUID</span><span class="p">,</span> <span class="n">SessionData</span><span class="p">],</span>
        <span class="n">auth_http_exception</span><span class="p">:</span> <span class="n">HTTPException</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_identifier</span> <span class="o">=</span> <span class="n">identifier</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_auto_error</span> <span class="o">=</span> <span class="n">auto_error</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_backend</span> <span class="o">=</span> <span class="n">backend</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_auth_http_exception</span> <span class="o">=</span> <span class="n">auth_http_exception</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">identifier</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_identifier</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">backend</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backend</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">auto_error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auto_error</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">auth_http_exception</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth_http_exception</span>

    <span class="k">def</span> <span class="nf">verify_session</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">SessionData</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;If the session exists, it is valid&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span>


<span class="n">verifier</span> <span class="o">=</span> <span class="n">BasicVerifier</span><span class="p">(</span>
    <span class="n">identifier</span><span class="o">=</span><span class="s2">&quot;general_verifier&quot;</span><span class="p">,</span>
    <span class="n">auto_error</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">,</span>
    <span class="n">auth_http_exception</span><span class="o">=</span><span class="n">HTTPException</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="mi">403</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;invalid session&quot;</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">()</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/create_session/</span><span class="si">{name}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">create_session</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">response</span><span class="p">:</span> <span class="n">Response</span><span class="p">):</span>

    <span class="n">session</span> <span class="o">=</span> <span class="n">uuid4</span><span class="p">()</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">SessionData</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

    <span class="k">await</span> <span class="n">backend</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
    <span class="n">cookie</span><span class="o">.</span><span class="n">attach_to_response</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">session</span><span class="p">)</span>

    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;created session for </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/whoami&quot;</span><span class="p">,</span> <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="n">Depends</span><span class="p">(</span><span class="n">cookie</span><span class="p">)])</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">whoami</span><span class="p">(</span><span class="n">session_data</span><span class="p">:</span> <span class="n">SessionData</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">verifier</span><span class="p">)):</span>
    <span class="k">return</span> <span class="n">session_data</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/delete_session&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">del_session</span><span class="p">(</span><span class="n">response</span><span class="p">:</span> <span class="n">Response</span><span class="p">,</span> <span class="n">session_id</span><span class="p">:</span> <span class="n">UUID</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">cookie</span><span class="p">)):</span>
    <span class="k">await</span> <span class="n">backend</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">session_id</span><span class="p">)</span>
    <span class="n">cookie</span><span class="o">.</span><span class="n">delete_from_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
    <span class="k">return</span> <span class="s2">&quot;deleted session&quot;</span>
</code></pre></div>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../../sessions/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Sessions" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Sessions
            </div>
          </div>
        </a>
      
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.709b4209.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.2b46852b.min.js"></script>
      
    
  </body>
</html>